import{j as s,u as k,r as d,c as _,a as h,H as $,P as C,L as S,b as l}from"./index-61083e70.js";function z({self:o,text:n}){return s("p",{className:`max-w-[50%]  w-fit rounded-md p-1 ${o&&"!bg-[var(--button-primary)]"} ${o&&"ml-auto !text-white"}`,children:n})}function H({socket:o}){const n=k(t=>t.user.user),i=d.useRef(null),{currentChat:x}=_(),[p,b]=d.useState(null),w=d.useRef(null),[v,f]=d.useState([]),[e,y]=d.useState(),[a,g]=d.useState(JSON.parse(x));o.active||o.connect();const M=d.useRef(a.members.find(t=>t!==n.handle));d.useEffect(()=>{(async()=>{try{if(a._id){const c=await l.get(`https://my-twitter-backend.onrender.com/messages/message/${a._id}`);f(c.data)}else{const c=await l.get(`https://my-twitter-backend.onrender.com/conversations/find/${a.members[0]}/${a.members[1]}`);if(c.data){g(c.data);const m=await l.get(`https://my-twitter-backend.onrender.com/messages/message/${c.data._id}`);f(m.data)}}const r=await l.get(`https://my-twitter-backend.onrender.com/users/get/${M.current}`);y(r.data)}catch(r){console.log(r)}})()},[a]),d.useEffect(()=>{var t;(t=w.current)==null||t.scrollIntoView({behavior:"smooth"})},[v]),d.useEffect(()=>{o.on("getMessage",t=>{b({sender:t.sender,text:t.text,createdAt:Date.now()})})},[]),d.useEffect(()=>{p&&a.members.includes(p.sender)&&f(t=>[...t,p])},[p]);const N=v.map((t,r)=>s("div",{ref:w,children:s(z,{text:t.text,self:t.sender===n.handle&&!0})},r));return h("div",{className:"h-screen flex flex-col",children:[s($,{}),h("div",{className:" px-10 flex w-full justify-center items-center flex-col gap-1",children:[e!=null&&e.pp?s(C,{pp:e==null?void 0:e.pp,handle:e==null?void 0:e.handle}):s(S,{to:`/profile/poster/${e==null?void 0:e.handle}`,children:s("div",{className:"w-9 h-9",children:s("svg",{viewBox:"0 0 24 24","aria-hidden":"true",children:s("g",{children:s("path",{d:"M5.651 19h12.698c-.337-1.8-1.023-3.21-1.945-4.19C15.318 13.65 13.838 13 12 13s-3.317.65-4.404 1.81c-.922.98-1.608 2.39-1.945 4.19zm.486-5.56C7.627 11.85 9.648 11 12 11s4.373.85 5.863 2.44c1.477 1.58 2.366 3.8 2.632 6.46l.11 1.1H3.395l.11-1.1c.266-2.66 1.155-4.88 2.632-6.46zM12 4c-1.105 0-2 .9-2 2s.895 2 2 2 2-.9 2-2-.895-2-2-2zM8 6c0-2.21 1.791-4 4-4s4 1.79 4 4-1.791 4-4 4-4-1.79-4-4z"})})})})}),s("h1",{children:e==null?void 0:e.username}),s("p",{children:e==null?void 0:e.handle}),s("p",{className:"whitespace-pre-wrap ",children:e==null?void 0:e.bio}),h("p",{children:[e==null?void 0:e.followingCount," followers"]})]}),s("div",{className:"message flex-col h-full overflow-y-scroll flex gap-y-10 p-2 ",children:N}),s("div",{className:"max-h-[60px] h-[60px] mt-2 bg-[var(--bg-primary)] w-full p-2",children:h("div",{className:"flex h-9 w-full bottom-0 gap-2 items-center",children:[s("input",{ref:i,type:"text",placeholder:"Send a new message",className:"w-full border-t",onKeyDown:t=>{var r,c;t.key==="Enter"&&(o.emit("sendMessage",{sender:n.handle,receiver:e==null?void 0:e.handle,text:(r=i.current)==null?void 0:r.value}),a._id?l.post("https://my-twitter-backend.onrender.com/messages/new",{sender:n.handle,conversationId:a._id,text:(c=i.current)==null?void 0:c.value}):l.post("https://my-twitter-backend.onrender.com/conversations/",{sender:n.handle,receiver:e==null?void 0:e.handle}).then(m=>{var u;g(m.data),l.post("https://my-twitter-backend.onrender.com/messages/new",{sender:n.handle,conversationId:m.data._id,text:(u=i.current)==null?void 0:u.value})}),i.current.value="")}}),s("div",{className:"w-7 h-7",onClick:t=>{var r,c;o.emit("sendMessage",{sender:n.handle,receiver:e==null?void 0:e.handle,text:(r=i.current)==null?void 0:r.value}),a._id?l.post("https://my-twitter-backend.onrender.com/messages/new",{sender:n.handle,conversationId:a._id,text:(c=i.current)==null?void 0:c.value}):l.post("https://my-twitter-backend.onrender.com/conversations/",{sender:n.handle,receiver:e==null?void 0:e.handle}).then(m=>{var u;g(m.data),l.post("https://my-twitter-backend.onrender.com/messages/new",{sender:n.handle,conversationId:m.data._id,text:(u=i.current)==null?void 0:u.value})}),i.current.value=""},children:s("svg",{id:"svg",viewBox:"0 0 24 24","aria-hidden":"true",children:s("g",{children:s("path",{d:"M2.504 21.866l.526-2.108C3.04 19.719 4 15.823 4 12s-.96-7.719-.97-7.757l-.527-2.109L22.236 12 2.504 21.866zM5.981 13c-.072 1.962-.34 3.833-.583 5.183L17.764 12 5.398 5.818c.242 1.349.51 3.221.583 5.183H10v2H5.981z"})})})})]})})]})}export{H as default};
